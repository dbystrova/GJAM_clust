output$decision
vi_DP.output$cl[1,]
vi_DP.output$cl
output$decision
vi_DP.output$cl[1,]
vi_DP.output$value
#### Add cluster labels
Colnames_Y_clust<- merge(Colnames_Y, Cluster_models, by ="CODE_CBNA")
### Covariance matrix for the mean
#pdf(file = "Plots/Correlation_matrix_DP.pdf", width= 8.27, height = 9.69)
MDP= fit_gjam$parameters$corMu
Colnames_Y_clust$Sp_name_DP <- paste(Colnames_Y_clust$ClustDP, Colnames_Y_clust$species,sep="_")
rownames(MDP)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_DP"],"other")
colnames(MDP)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_DP"],"other")
colors_vir=viridis(length(unique(Colnames_Y_clust$ClustDP))+1, option = "magma")
LabelCol = sapply(c(Colnames_Y_clust[order(Colnames_Y_clust$Sp_name_DP),"ClustDP"],length(unique(Colnames_Y_clust$ClustDP))+1), function(x) colors_vir[x])
cols = colorRampPalette(c("dark blue","white","red"))
col2 <- colorRampPalette(c("#4393C3", "#2166AC", "#053061",
"#FDDBC7", "#FFFFFF", "#D1E5F0", "#92C5DE",
"#67001F", "#B2182B", "#D6604D", "#F4A582"))
VI_fin_table_K<-tibble(GJAM = length(unique(DP_clust2$VI_est)),GJAM1=length(unique(DP1_clust2$VI_est)),PY1=length(unique(PY1_clust2$VI_est)),PY2=length(unique(PY2_clust2$VI_est)))
VI_fin_table_VIdist<-  tibble(GJAM = vi.dist(DP_clust2$VI_est, True_clust$K_n),GJAM1 = vi.dist(DP1_clust2$VI_est, True_clust$K_n),PY1= vi.dist(PY1_clust2$VI_est, True_clust$K_n),PY2= vi.dist(PY2_clust2$VI_est, True_clust$K_n))
VI_fin_table_ARdist<- tibble(GJAM = arandi(DP_clust2$VI_est, True_clust$K_n),GJAM1 = arandi(DP1_clust2$VI_est, True_clust$K_n),PY1 = arandi(PY1_clust2$VI_est, True_clust$K_n),PY2 = arandi(PY2_clust2$VI_est, True_clust$K_n))
VI_fin_table_ARdist
VI_fin_table_K
VI_fin_table_K<-tibble(GJAM = length(unique(DP_clust$VI_est)),GJAM1=length(unique(DP1_clust$VI_est)),PY1=length(unique(PY1_clust$VI_est)),PY2=length(unique(PY2_clust$VI_est)))
VI_fin_table_VIdist<-  tibble(GJAM = vi.dist(DP_clust$VI_est, True_clust$K_n),GJAM1 = vi.dist(DP1_clust$VI_est, True_clust$K_n),PY1= vi.dist(PY1_clust$VI_est, True_clust$K_n),PY2= vi.dist(PY2_clust$VI_est, True_clust$K_n))
VI_fin_table_ARdist<- tibble(GJAM = arandi(DP_clust$VI_est, True_clust$K_n),GJAM1 = arandi(DP1_clust$VI_est, True_clust$K_n),PY1 = arandi(PY1_clust$VI_est, True_clust$K_n),PY2 = arandi(PY2_clust$VI_est, True_clust$K_n))
VI_fin_table_ARdist
VI_fin_table_K
arandi(DP1_clust$VI_est, PY1_clust$VI_est)
table((DP1_clust$VI_est)
)
table( PY1_clust$VI_est)
plot(1:14,PY1_clust$VI_est )
plot,PY1_clust$VI_est )
plot(PY1_clust$VI_est )
plot(1:14, table( PY1_clust$VI_est) )
plot(1:14, table( DP1_clust$VI_est) )
plot(1:17, table( DP1_clust$VI_est) )
DP1_clust$VI_est
PY1_clust$VI_est
arandi(PY1_grEPL$decision,PY1_clust$VI_est)
arandi(PY1_grEPL$decision,DP1_grEPL$decision)
arandi(DP1_clust$VI_est,PY1_grEPL$decision)
arandi(DP1_clust$VI_est,PY1_clust$VI_est)
arandi(DP1_clust$VI_est,PY1_clust$VI_est)
arandi(PY1_grEPL$decision,DP1_grEPL$decision)
arandi(PY1_grEPL$decision,PY1_clust$VI_est)
arandi(DP1_clust$VI_est,DP1_clust$VI_est)
arandi(DP1_grEPL$decision,DP1_clust$VI_est)
arandi(PY1_grEPL$decision,DP1_grEPL$decision)
arandi(DP_grEPL$decision,DP_clust$VI_est)
arandi(DP_grEPL$decision,DP1_grEPL$decision)
MatDP<- fit_gjam$chains$kgibbs[(fit_gjam$modelList$burnin+1):fit_gjam$modelList$ng,1:111]
DP_grEPL<- MinimiseEPL(MatDP, pars = list(Kup = 1, loss_type ="VI"))
DP_grEPL$decision
x = DP_grEPL$decision
length(unique(x))
MatDP<- fit_gjam$chains$kgibbs[(fit_gjam$modelList$burnin+1):fit_gjam$modelList$ng,1:112]
DP_grEPL<- MinimiseEPL(MatDP, pars = list(Kup = 1, loss_type ="VI"))
DP_grEPL$decision
DP_grEPL$EPL
length(DP_grEPL$EPL)
length(DP_grEPL$decision)
length(unique(DP_grEPL$decision))
table(DP_grEPL$decision)
plot(1:46, table(DP_grEPL$decision))
plot(1:46, order(table(DP_grEPL$decision), descending=TRUE))
plot(1:46, table(DP_grEPL$decision), type="l")
arandi(DP_grEPL$decision[1:111], x)
gjamClust2<- function(model){
if("other" %in% colnames(model$inputs$y)){
sp_num<- ncol(model$inputs$y)-1
}
MatDP<- relabel_clust(model$chains$kgibbs[(model$modelList$burnin+1):model$modelList$ng,1:sp_num])
DP_grEPL<- MinimiseEPL(MatDP, pars = list("VI"))
return(list( VI_est = DP_grEPL$decision))
}
gjamClust2<- function(model){
if("other" %in% colnames(model$inputs$y)){
sp_num<- ncol(model$inputs$y)-1
}
MatDP<- relabel_clust(model$chains$kgibbs[(model$modelList$burnin+1):model$modelList$ng,1:sp_num])
DP_grEPL<- MinimiseEPL(MatDP, pars = list("VI"))
return(list( VI_est = DP_grEPL$decision))
}
DP_clust2<- gjamClust2(model= fit_gjam)
DP1_clust2<- gjamClust2(model= fit_gjamDP1)
PY1_clust2<- gjamClust2(model= fit_gjamPY1)
PY2_clust2<- gjamClust2(model= fit_gjamPY2)
VI_fin_table_K2<-tibble(GJAM = length(unique(DP_clust2$VI_est)),GJAM1=length(unique(DP1_clust2$VI_est)),PY1=length(unique(PY1_clust2$VI_est)),PY2=length(unique(PY2_clust2$VI_est)))
VI_fin_table_VIdist2<-  tibble(GJAM = vi.dist(DP_clust2$VI_est, True_clust$K_n),GJAM1 = vi.dist(DP1_clust2$VI_est, True_clust$K_n),PY1= vi.dist(PY1_clust2$VI_est, True_clust$K_n),PY2= vi.dist(PY2_clust2$VI_est, True_clust$K_n))
VI_fin_table_ARdist2<- tibble(GJAM = arandi(DP_clust2$VI_est, True_clust$K_n),GJAM1 = arandi(DP1_clust2$VI_est, True_clust$K_n),PY1 = arandi(PY1_clust2$VI_est, True_clust$K_n),PY2 = arandi(PY2_clust2$VI_est, True_clust$K_n))
A=load_object("PCA_analysis/r5_25/Clusters_modells.Rdata")
c1<-PY1_clust$VI_est
c2<-DP1_clust$VI_est
arandi(A$ClustPY1,c1 )
arandi(A$ClustDP2,c2)
arandi(c1,c2)
arandi(A$ClustPY1,PY1_clust2$decision )
A$ClustPY1
PY1_clust2$decision
PY1_clust2$VI_est
arandi(A$ClustPY1,PY1_clust2$VI_est )
arandi(A$ClustDP2,DP1_clust2$VI_est )
arandi(c1,PY1_grEPL$decision )
vi.dist(A$ClustDP2,DP1_clust2$VI_est  )
vi.dist(A$ClustDP2,DP1_clust2$VI_est  )
arandi(A$ClustDP2,DP1_clust2$VI_est )
###############################################################################################################
# sp_num<- ncol(Ydata)-1
# MatDP<- relabel_clust(fit_gjam$chains$kgibbs[(fit_gjam$modelList$burnin+1):fit_gjam$modelList$ng,1:sp_num])
MatDP1<- relabel_clust(fit_gjamDP1$chains$kgibbs[(fit_gjamDP1$modelList$burnin+1):fit_gjamDP1$modelList$ng,1:sp_num])
DP1_cb = credibleball(DP1_clust$VI_est, MatDP1, c.dist = c("VI"), alpha = 0.05)
summary(DP1_cb)
relabel_clust<- function(Mat ){
Mat_new<- matrix(NA, nrow=nrow(Mat),ncol=ncol(Mat))
for(i in 1:nrow(Mat) ){
label<-unique(Mat[i,])
change<- label[which(label>ncol(Mat))]
all_n<- 1:ncol(Mat)
admis<- all_n[which(!(all_n %in% label))]
Mat_new[i,]<-Mat[i,]
if(length(change)>0){
for(k in 1:length(change)){
old_row<- Mat_new[i,]
rep <-old_row==change[k]
Mat_new[i,] <- replace(Mat_new[i,], rep, admis[k])
}
}
}
return(Mat_new)
}
gjamClust<- function(model){
if("other" %in% colnames(model$inputs$y)){
sp_num<- ncol(model$inputs$y)-1
}
MatDP<- relabel_clust(model$chains$kgibbs[(model$modelList$burnin+1):model$modelList$ng,1:sp_num])
CM_DP<-  comp.psm(MatDP)
mbind_DP.ext <- minbinder.ext(CM_DP,MatDP, method="all",include.greedy = TRUE)
vi_DP.ext <- minVI(CM_DP,MatDP, method="all", include.greedy = TRUE)
return(list(Bind_est=mbind_DP.ext$cl[1,], VI_est = vi_DP.ext$cl[1,]))
}
DP_clust<- gjamClust(model= fit_gjam)
DP1_clust<- gjamClust(model= fit_gjamDP1)
PY1_clust<- gjamClust(model= fit_gjamPY1)
PY2_clust<- gjamClust(model= fit_gjamPY2)
#### Compare the obtained estimates with the PFG clusters
BI_fin_table_K<- tibble(GJAM = length(unique(DP_clust$Bind_est)),GJAM1=length(unique(DP1_clust$Bind_est)),PY1=length(unique(PY1_clust$Bind_est)),PY2=length(unique(PY2_clust$Bind_est)))
BI_fin_table_VIdist<- tibble(GJAM = vi.dist(DP_clust$Bind_est, True_clust$K_n),GJAM1 = vi.dist(DP1_clust$Bind_est, True_clust$K_n),PY1= vi.dist(PY1_clust$Bind_est, True_clust$K_n),PY2= vi.dist(PY2_clust$Bind_est, True_clust$K_n))
BI_fin_table_ARdist<- tibble(GJAM = arandi(DP_clust$Bind_est, True_clust$K_n),GJAM1 = arandi(DP1_clust$Bind_est, True_clust$K_n),PY1 = arandi(PY1_clust$Bind_est, True_clust$K_n),PY2 = arandi(PY2_clust$Bind_est, True_clust$K_n))
VI_fin_table_K<-tibble(GJAM = length(unique(DP_clust$VI_est)),GJAM1=length(unique(DP1_clust$VI_est)),PY1=length(unique(PY1_clust$VI_est)),PY2=length(unique(PY2_clust$VI_est)))
VI_fin_table_VIdist<-  tibble(GJAM = vi.dist(DP_clust$VI_est, True_clust$K_n),GJAM1 = vi.dist(DP1_clust$VI_est, True_clust$K_n),PY1= vi.dist(PY1_clust$VI_est, True_clust$K_n),PY2= vi.dist(PY2_clust$VI_est, True_clust$K_n))
VI_fin_table_ARdist<- tibble(GJAM = arandi(DP_clust$VI_est, True_clust$K_n),GJAM1 = arandi(DP1_clust$VI_est, True_clust$K_n),PY1 = arandi(PY1_clust$VI_est, True_clust$K_n),PY2 = arandi(PY2_clust$VI_est, True_clust$K_n))
gjamClust2<- function(model){
if("other" %in% colnames(model$inputs$y)){
sp_num<- ncol(model$inputs$y)-1
}
MatDP<- relabel_clust(model$chains$kgibbs[(model$modelList$burnin+1):model$modelList$ng,1:sp_num])
DP_grEPL<- MinimiseEPL(MatDP, pars = list("VI"))
return(list( VI_est = DP_grEPL$decision))
}
#MatDP<- fit_gjam$chains$kgibbs[(fit_gjam$modelList$burnin+1):fit_gjam$modelList$ng,1:112]
#DP_grEPL<- MinimiseEPL(MatDP, pars = list(Kup = 1, loss_type ="VI"))
DP_clust2<- gjamClust2(model= fit_gjam)
DP1_clust2<- gjamClust2(model= fit_gjamDP1)
PY1_clust2<- gjamClust2(model= fit_gjamPY1)
PY2_clust2<- gjamClust2(model= fit_gjamPY2)
VI_fin_table_K2<-tibble(GJAM = length(unique(DP_clust2$VI_est)),GJAM1=length(unique(DP1_clust2$VI_est)),PY1=length(unique(PY1_clust2$VI_est)),PY2=length(unique(PY2_clust2$VI_est)))
VI_fin_table_VIdist2<-  tibble(GJAM = vi.dist(DP_clust2$VI_est, True_clust$K_n),GJAM1 = vi.dist(DP1_clust2$VI_est, True_clust$K_n),PY1= vi.dist(PY1_clust2$VI_est, True_clust$K_n),PY2= vi.dist(PY2_clust2$VI_est, True_clust$K_n))
VI_fin_table_ARdist2<- tibble(GJAM = arandi(DP_clust2$VI_est, True_clust$K_n),GJAM1 = arandi(DP1_clust2$VI_est, True_clust$K_n),PY1 = arandi(PY1_clust2$VI_est, True_clust$K_n),PY2 = arandi(PY2_clust2$VI_est, True_clust$K_n))
############################################################################################################
#
A=load_object("PCA_analysis/r5_25/Clusters_modells.Rdata")
c1<-PY1_clust$VI_est
c2<-DP1_clust$VI_est
#
arandi(A$ClustPY1,c1 )
arandi(A$ClustDP2,c2)
arandi(c1,c2)
############################################################################################################
#
# A=load_object("PCA_analysis/r5_25/Clusters_modells.Rdata")
# c1<-PY1_clust$VI_est
# c2<-DP1_clust$VI_est
#
# arandi(A$ClustPY1,c1 )
# arandi(A$ClustDP2,c2)
# arandi(c1,c2)
#
arandi(A$ClustPY1,PY1_clust2$VI_est )
arandi(A$ClustDP2,DP1_clust2$VI_est )
# c1<-PY1_clust$VI_est
# c2<-DP1_clust$VI_est
#
# arandi(A$ClustPY1,c1 )
# arandi(A$ClustDP2,c2)
# arandi(c1,c2)
#
# arandi(A$ClustPY1,PY1_clust2$VI_est )
# arandi(A$ClustDP2,DP1_clust2$VI_est )
#
arandi(c1,PY1_grEPL$decision )
vi.dist(A$ClustDP2,DP1_clust2$VI_est  )
# c1<-PY1_clust$VI_est
# c2<-DP1_clust$VI_est
#
# arandi(A$ClustPY1,c1 )
# arandi(A$ClustDP2,c2)
# arandi(c1,c2)
#
# arandi(A$ClustPY1,PY1_clust2$VI_est )
# arandi(A$ClustDP2,DP1_clust2$VI_est )
#
arandi(PY1_clust2$VI_est,PY1_clust$VI_est)
arandi(PY1_clust2$VI_est,DP1_clust2$VI_est )
arandi(PY1_clust$VI_est,DP1_clust$VI_est )
arandi(DP1_clust2$VI_est,DP1_clust$VI_est )
length(unique((DP1_clust2$VI_est))
)
length(unique((DP1_clust$VI_est))
)
Cluster_models1<- tibble( CODE_CBNA=colnames(Ydata)[1:(ncol(Ydata)-1)],  ClustDP=DP_clust$VI_est,
ClustDP2=DP2_clust$VI_est,ClustPY1=PY1_clust$VI_est, PFG=True_clust$K_n)
save(Cluster_models1, file =  paste0(folderpath,"Clusters_modells_1.Rdata"))
Cluster_models_1<- tibble( CODE_CBNA=colnames(Ydata)[1:(ncol(Ydata)-1)],  ClustDP=DP_clust$VI_est,
ClustDP1=DP1_clust$VI_est,ClustPY1=PY1_clust$VI_est,PFG=True_clust$K_n)
save(Cluster_models_1, file =  paste0(folderpath,"Clusters_modells_1.Rdata"))
Cluster_models_2<- tibble( CODE_CBNA=colnames(Ydata)[1:(ncol(Ydata)-1)],  ClustDP=DP_clust2$VI_est,
ClustDP1=DP1_clust2$VI_est,ClustPY1=PY1_clust2$VI_est,PFG=True_clust$K_n)
save(Cluster_models_2, file =  paste0(folderpath,"Clusters_modells_2.Rdata"))
arandi(Cluster_models_2$ClustPY1, PY1_clust2$VI_est)
Colnames_Y_clust<- merge(Colnames_Y, Cluster_models_2, by ="CODE_CBNA")
MDP= fit_gjam$parameters$corMu
Colnames_Y_clust$Sp_name_DP <- paste(Colnames_Y_clust$ClustDP, Colnames_Y_clust$species,sep="_")
rownames(MDP)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_DP"],"other")
colnames(MDP)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_DP"],"other")
colors_vir=viridis(length(unique(Colnames_Y_clust$ClustDP))+1, option = "magma")
LabelCol = sapply(c(Colnames_Y_clust[order(Colnames_Y_clust$Sp_name_DP),"ClustDP"],length(unique(Colnames_Y_clust$ClustDP))+1), function(x) colors_vir[x])
cols = colorRampPalette(c("dark blue","white","red"))
col2 <- colorRampPalette(c("#4393C3", "#2166AC", "#053061",
"#FDDBC7", "#FFFFFF", "#D1E5F0", "#92C5DE",
"#67001F", "#B2182B", "#D6604D", "#F4A582"))
corrplot(MDP, diag = FALSE, order = "hclust", tl.cex = 0.45,tl.srt=45, method = "color", tl.col=LabelCol,col=cols(200),
type = "full", title= "Correlation for the DP model (original)", mar=c(0,0,1,0))
corrplot(MDP, diag = FALSE, order = "hclust", tl.cex = 0.45,tl.srt=45, method = "color", tl.col=LabelCol,col=cols(200),
type = "full", title= "Correlation for the DP model (original)", mar=c(0,0,1,0))
corrplot(MDP, diag = FALSE, order = "alphabet", tl.cex = 0.45,tl.srt=45,  tl.col=LabelCol,
method = "color",col=cols(200), type = "full",title= "Correlation for the DP model (DP groups)", mar=c(0,0,1,0))
Colnames_Y_clust$Sp_name_DP1 <- paste(Colnames_Y_clust$ClustDP1, Colnames_Y_clust$species,sep="_")
#pdf(file = "Plots/Correlation_matrix_DP2.pdf", width= 8.27, height = 9.69)
MDP1= fit_gjamDP1$parameters$corMu
Colnames_Y_clust$Sp_name_DP1 <- paste(Colnames_Y_clust$ClustDP1, Colnames_Y_clust$species,sep="_")
rownames(MDP1)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_DP1"],"other")
colnames(MDP1)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_DP1"],"other")
colors_vir=viridis(length(unique(Colnames_Y_clust$ClustDP1))+1, option = "magma")
LabelCol = sapply(c(Colnames_Y_clust[order(Colnames_Y_clust$Sp_name_DP1),"ClustDP1"],15), function(x) colors_vir[x])
corrplot(MDP1, diag = FALSE, order = "original",tl.pos = "ld", tl.cex = 0.45,tl.srt=45, method = "color",col=cols(200),
type = "lower", title= "Correlation for the DP1 model (original)", mar=c(0,0,1,0))
corrplot(MDP1, diag = FALSE, order = "alphabet", tl.cex = 0.45,tl.srt=45, tl.col=LabelCol,method = "color",col=cols(200),
type = "full", title= "Correlation for the DP1 model (DP2 groups)", mar=c(0,0,1,0))
MPY1= fit_gjamPY1$parameters$corMu
Colnames_Y_clust$Sp_name_PY1 <- paste(Colnames_Y_clust$ClustPY1, Colnames_Y_clust$species,sep="_")
rownames(MPY1)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_PY1"],"other")
colnames(MPY1)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_PY1"],"other")
colors_vir=viridis(length(unique(Colnames_Y_clust$ClustPY1))+1, option = "magma")
LabelCol = sapply(c(Colnames_Y_clust[order(Colnames_Y_clust$Sp_name_PY1),"ClustPY1"],19), function(x) colors_vir[x])
corrplot(MPY1, diag = FALSE, order = "hclust", tl.cex = 0.45,tl.srt=45, method = "color",col=cols(200),
type = "full", title= "Correlation for the PY1 model (hclust)", mar=c(0,0,1,0))
corrplot(MPY1, diag = FALSE, order = "alphabet", tl.cex = 0.45,tl.srt=45, tl.col=LabelCol,method = "color",col=cols(200),
type = "full", title= "Correlation for the PY1 model (PY1 groups)", mar=c(0,0,1,0))
MPY2= fit_gjamPY2$parameters$corMu
Colnames_Y_clust$Sp_name_PY2 <- paste(Colnames_Y_clust$ClustPY1, Colnames_Y_clust$species,sep="_")
rownames(MPY2)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_PY2"],"other")
colnames(MPY2)=c(Colnames_Y_clust[order(Colnames_Y_clust$CN),"Sp_name_PY2"],"other")
colors_vir=viridis(length(unique(Colnames_Y_clust$ClustPY2))+1, option = "magma")
LabelCol = sapply(c(Colnames_Y_clust[order(Colnames_Y_clust$Sp_name_PY2),"ClustPY2"],length(unique(Colnames_Y_clust$ClustPY2))+1), function(x) colors_vir[x])
Colnames_Y_clust
head(Cluster_models_2)
form<-c(formula)
Fin_all<-as.data.frame(matrix(NA,nrow=12,ncol=8))
names(Fin_all)<- c("Parameter","GJAM","GJAM1","PY1","PY2","r", "iter", "burn","formula")
Fin_all$iter<- fit_gjam$modelList$ng
Fin_all$burn<- fit_gjam$modelList$burnin
Fin_all$r<-fit_gjam$modelList$reductList$r
Fin_all$formula<-as.character(form)
Fin_all[1,1]<- "DIC"
Fin_all[1,2:5]<- c(fit_gjam$fit$DIC,fit_gjamDP1$fit$DIC,fit_gjamPY1$fit$DIC,fit_gjamPY2$fit$DIC))/10000
Fin_all[2,1]<- "mean AUC"
Fin_all[2,2:5]<- AUC_fin_table
Fin_all[3,1]<- "mean WAUC"
Fin_all[3,2:5]<- WAUC_fin_table
Fin_all[4,1]<- "AUC in"
Fin_all[4,2:5]<- AUC_fin_in_table
Fin_all[5,1]<- "AUC cond"
Fin_all[5,2:5]<- AUC_fin_cond_table
Fin_all[6,1]<- "VI dist Binder loss"
Fin_all[6,2:5]<- BI_fin_table_VIdist
Fin_all[7,1]<- "AR dist Binder loss"
Fin_all[7,2:5]<- BI_fin_table_ARdist
Fin_all[8,1]<- "VI dist VI loss"
Fin_all[8,2:5]<- VI_fin_table_VIdist
Fin_all[9,1]<- "AR dist VI loss"
Fin_all[9,2:5]<- VI_fin_table_ARdist
Fin_all[10,1]<- "mean K"
Fin_all[10,2:5]<- c(mean(apply(fit_gjam$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjam$modelList$burnin:fit_gjam$modelList$ng]),
mean(apply(fit_gjamDP1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamDP1$modelList$burnin:fit_gjamDP1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY1$modelList$burnin:fit_gjamPY1$modelList$ng]),mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY2$modelList$burnin:fit_gjamPY2$modelList$ng]))
#Fin_all[11,1]<- "K Bind"
#Fin_all[11,2:4]<- BI_fin_table_K
Fin_all[11,1]<- "K VI"
Fin_all[11,2:5]<- VI_fin_table_K
Fin_all[,2:5]<- round(Fin_all[,2:5], 3)
#### Final Table
form<-c(formula)
Fin_all<-as.data.frame(matrix(NA,nrow=12,ncol=8))
names(Fin_all)<- c("Parameter","GJAM","GJAM1","PY1","PY2","r", "iter", "burn","formula")
Fin_all$iter<- fit_gjam$modelList$ng
Fin_all$burn<- fit_gjam$modelList$burnin
Fin_all$r<-fit_gjam$modelList$reductList$r
Fin_all$formula<-as.character(form)
Fin_all[1,1]<- "DIC"
Fin_all[1,2:5]<- c(fit_gjam$fit$DIC,fit_gjamDP1$fit$DIC,fit_gjamPY1$fit$DIC,fit_gjamPY2$fit$DIC)/10000
Fin_all[2,1]<- "mean AUC"
Fin_all[2,2:5]<- AUC_fin_table
Fin_all[3,1]<- "mean WAUC"
Fin_all[3,2:5]<- WAUC_fin_table
Fin_all[4,1]<- "AUC in"
Fin_all[4,2:5]<- AUC_fin_in_table
Fin_all[5,1]<- "AUC cond"
Fin_all[5,2:5]<- AUC_fin_cond_table
Fin_all[6,1]<- "VI dist Binder loss"
Fin_all[6,2:5]<- BI_fin_table_VIdist
Fin_all[7,1]<- "AR dist Binder loss"
Fin_all[7,2:5]<- BI_fin_table_ARdist
Fin_all[8,1]<- "VI dist VI loss"
Fin_all[8,2:5]<- VI_fin_table_VIdist
Fin_all[9,1]<- "AR dist VI loss"
Fin_all[9,2:5]<- VI_fin_table_ARdist
Fin_all[10,1]<- "mean K"
Fin_all[10,2:5]<- c(mean(apply(fit_gjam$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjam$modelList$burnin:fit_gjam$modelList$ng]),
mean(apply(fit_gjamDP1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamDP1$modelList$burnin:fit_gjamDP1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY1$modelList$burnin:fit_gjamPY1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY2$modelList$burnin:fit_gjamPY2$modelList$ng]))
#Fin_all[11,1]<- "K Bind"
#Fin_all[11,2:4]<- BI_fin_table_K
Fin_all[11,1]<- "K VI"
Fin_all[11,2:5]<- VI_fin_table_K
Fin_all[,2:5]<- round(Fin_all[,2:5], 3)
Fin_all
form<-c(formula)
Fin_all<-as.data.frame(matrix(NA,nrow=12,ncol=8))
names(Fin_all)<- c("Parameter","GJAM","GJAM1","PY1","PY2","r", "iter", "burn","formula")
Fin_all$iter<- fit_gjam$modelList$ng
Fin_all$burn<- fit_gjam$modelList$burnin
Fin_all$r<-fit_gjam$modelList$reductList$r
Fin_all$formula<-as.character(form)
Fin_all[1,1]<- "DIC"
Fin_all[1,2:5]<- c(fit_gjam$fit$DIC,fit_gjamDP1$fit$DIC,fit_gjamPY1$fit$DIC,fit_gjamPY2$fit$DIC)/10000
Fin_all[2,1]<- "mean AUC"
Fin_all[2,2:5]<- AUC_fin_table
Fin_all[3,1]<- "mean WAUC"
Fin_all[3,2:5]<- WAUC_fin_table
Fin_all[4,1]<- "AUC in"
Fin_all[4,2:5]<- AUC_fin_in_table
Fin_all[7,1]<- "AR dist VI loss 2"
Fin_all[7,2:5]<- VI_fin_table_ARdist2
Fin_all[9,1]<- "AR dist VI loss"
Fin_all[9,2:5]<- VI_fin_table_ARdist
Fin_all[10,1]<- "mean K"
Fin_all[10,2:5]<- c(mean(apply(fit_gjam$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjam$modelList$burnin:fit_gjam$modelList$ng]),
mean(apply(fit_gjamDP1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamDP1$modelList$burnin:fit_gjamDP1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY1$modelList$burnin:fit_gjamPY1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY2$modelList$burnin:fit_gjamPY2$modelList$ng]))
Fin_all[11,1]<- "K VI2"
Fin_all[11,2:4]<- VI_fin_table_K
Fin_all[11,1]<- "K VI"
Fin_all[11,2:5]<- VI_fin_table_K
Fin_all[,2:5]<- round(Fin_all[,2:5], 3)
#### Final Table
form<-c(formula)
Fin_all<-as.data.frame(matrix(NA,nrow=12,ncol=8))
names(Fin_all)<- c("Parameter","GJAM","GJAM1","PY1","PY2","r", "iter", "burn","formula")
Fin_all$iter<- fit_gjam$modelList$ng
Fin_all$burn<- fit_gjam$modelList$burnin
Fin_all$r<-fit_gjam$modelList$reductList$r
Fin_all$formula<-as.character(form)
Fin_all[1,1]<- "DIC"
Fin_all[1,2:5]<- c(fit_gjam$fit$DIC,fit_gjamDP1$fit$DIC,fit_gjamPY1$fit$DIC,fit_gjamPY2$fit$DIC)/10000
Fin_all[2,1]<- "mean AUC"
Fin_all[2,2:5]<- AUC_fin_table
Fin_all[3,1]<- "mean WAUC"
Fin_all[3,2:5]<- WAUC_fin_table
Fin_all[4,1]<- "AUC in"
Fin_all[4,2:5]<- AUC_fin_in_table
Fin_all[7,1]<- "AR dist VI loss 2"
Fin_all[7,2:5]<- VI_fin_table_ARdist2
Fin_all[9,1]<- "AR dist VI loss"
Fin_all[9,2:5]<- VI_fin_table_ARdist
Fin_all[10,1]<- "mean K"
Fin_all[10,2:5]<- c(mean(apply(fit_gjam$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjam$modelList$burnin:fit_gjam$modelList$ng]),
mean(apply(fit_gjamDP1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamDP1$modelList$burnin:fit_gjamDP1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY1$modelList$burnin:fit_gjamPY1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY2$modelList$burnin:fit_gjamPY2$modelList$ng]))
Fin_all[11,1]<- "K VI2"
Fin_all[11,2:5]<- VI_fin_table_K2
Fin_all[11,1]<- "K VI"
Fin_all[11,2:5]<- VI_fin_table_K
Fin_all[,2:5]<- round(Fin_all[,2:5], 3)
Fin_all
VI_fin_table_K2<-tibble(GJAM = length(unique(DP_clust2$VI_est)),GJAM1=length(unique(DP1_clust2$VI_est)),PY1=length(unique(PY1_clust2$VI_est)),PY2=length(unique(PY2_clust2$VI_est)))
VI_fin_table_VIdist2<-  tibble(GJAM = vi.dist(DP_clust2$VI_est, True_clust$K_n),GJAM1 = vi.dist(DP1_clust2$VI_est, True_clust$K_n),PY1= vi.dist(PY1_clust2$VI_est, True_clust$K_n),PY2= vi.dist(PY2_clust2$VI_est, True_clust$K_n))
VI_fin_table_ARdist2<- tibble(GJAM = arandi(DP_clust2$VI_est, True_clust$K_n),GJAM1 = arandi(DP1_clust2$VI_est, True_clust$K_n),PY1 = arandi(PY1_clust2$VI_est, True_clust$K_n),PY2 = arandi(PY2_clust2$VI_est, True_clust$K_n))
form<-c(formula)
Fin_all<-as.data.frame(matrix(NA,nrow=12,ncol=8))
names(Fin_all)<- c("Parameter","GJAM","GJAM1","PY1","PY2","r", "iter", "burn","formula")
Fin_all$iter<- fit_gjam$modelList$ng
Fin_all$burn<- fit_gjam$modelList$burnin
Fin_all$r<-fit_gjam$modelList$reductList$r
Fin_all$formula<-as.character(form)
Fin_all[1,1]<- "DIC"
Fin_all[1,2:5]<- c(fit_gjam$fit$DIC,fit_gjamDP1$fit$DIC,fit_gjamPY1$fit$DIC,fit_gjamPY2$fit$DIC)/10000
Fin_all[2,1]<- "mean AUC"
Fin_all[2,2:5]<- AUC_fin_table
Fin_all[3,1]<- "mean WAUC"
Fin_all[3,2:5]<- WAUC_fin_table
Fin_all[4,1]<- "AUC in"
Fin_all[4,2:5]<- AUC_fin_in_table
Fin_all[7,1]<- "AR dist VI loss 2"
Fin_all[7,2:5]<- VI_fin_table_ARdist2
Fin_all[9,1]<- "AR dist VI loss"
Fin_all[9,2:5]<- VI_fin_table_ARdist
Fin_all[10,1]<- "mean K"
Fin_all[10,2:5]<- c(mean(apply(fit_gjam$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjam$modelList$burnin:fit_gjam$modelList$ng]),
mean(apply(fit_gjamDP1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamDP1$modelList$burnin:fit_gjamDP1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY1$modelList$burnin:fit_gjamPY1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY2$modelList$burnin:fit_gjamPY2$modelList$ng]))
Fin_all[12,1]<- "K VI2"
Fin_all[12,2:5]<- VI_fin_table_K2
Fin_all[13,1]<- "K VI"
Fin_all[13,2:5]<- VI_fin_table_K
Fin_all[,2:5]<- round(Fin_all[,2:5], 3)
Fin_all
save(Fin_all, file = paste0(folderpath,"Fin_tab_opt.Rdata"))
form<-c(formula)
Fin_all<-as.data.frame(matrix(NA,nrow=9,ncol=8))
names(Fin_all)<- c("Parameter","GJAM","GJAM1","PY1","r", "iter", "burn","formula")
Fin_all$iter<- fit_gjam$modelList$ng
Fin_all$burn<- fit_gjam$modelList$burnin
Fin_all$r<-fit_gjam$modelList$reductList$r
Fin_all$formula<-as.character(form)
Fin_all[1,1]<- "DIC"
Fin_all[1,2:4]<- c(fit_gjam$fit$DIC,fit_gjamDP1$fit$DIC,fit_gjamPY1$fit$DIC)/10000
Fin_all[2,1]<- "mean AUC"
Fin_all[2,2:4]<- AUC_fin_table
Fin_all[3,1]<- "mean WAUC"
Fin_all[3,2:4]<- WAUC_fin_table
Fin_all[4,1]<- "AUC in"
Fin_all[4,2:4]<- AUC_fin_in_table
Fin_all[5,1]<- "AR dist VI loss 2"
Fin_all[5,2:4]<- VI_fin_table_ARdist2
Fin_all[6,1]<- "AR dist VI loss"
Fin_all[6,2:4]<- VI_fin_table_ARdist
Fin_all[7,1]<- "mean K"
Fin_all[7,2:4]<- c(mean(apply(fit_gjam$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjam$modelList$burnin:fit_gjam$modelList$ng]),
mean(apply(fit_gjamDP1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamDP1$modelList$burnin:fit_gjamDP1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY1$modelList$burnin:fit_gjamPY1$modelList$ng]))
Fin_all[8,1]<- "K VI2"
Fin_all[8,2:5]<- VI_fin_table_K2
Fin_all[9,1]<- "K VI"
Fin_all[9,2:5]<- VI_fin_table_K
Fin_all[,2:5]<- round(Fin_all[,2:5], 3)
save(Fin_all, file = paste0(folderpath,"Fin_tab_opt.Rdata"))
Fin_all[2,2:4]<- AUC_fin_table[, 1:4]
AUC_fin_table[, 1:4]
form<-c(formula)
Fin_all<-as.data.frame(matrix(NA,nrow=9,ncol=8))
names(Fin_all)<- c("Parameter","GJAM","GJAM1","PY1","r", "iter", "burn","formula")
Fin_all$iter<- fit_gjam$modelList$ng
Fin_all$burn<- fit_gjam$modelList$burnin
Fin_all$r<-fit_gjam$modelList$reductList$r
Fin_all$formula<-as.character(form)
Fin_all[1,1]<- "DIC"
Fin_all[1,2:4]<- c(fit_gjam$fit$DIC,fit_gjamDP1$fit$DIC,fit_gjamPY1$fit$DIC)/10000
Fin_all[2,1]<- "mean AUC"
Fin_all[2,2:4]<- AUC_fin_table[,1:3]
Fin_all[3,1]<- "mean WAUC"
Fin_all[3,2:4]<- WAUC_fin_table[,1:3]
Fin_all[4,1]<- "AUC in"
Fin_all[4,2:4]<- AUC_fin_in_table[,1:3]
Fin_all[5,1]<- "AR dist VI loss 2"
Fin_all[5,2:4]<- VI_fin_table_ARdist2[,1:3]
Fin_all[6,1]<- "AR dist VI loss"
Fin_all[6,2:4]<- VI_fin_table_ARdist[,1:3]
Fin_all[7,1]<- "mean K"
Fin_all[7,2:4]<- c(mean(apply(fit_gjam$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjam$modelList$burnin:fit_gjam$modelList$ng]),
mean(apply(fit_gjamDP1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamDP1$modelList$burnin:fit_gjamDP1$modelList$ng]),
mean(apply(fit_gjamPY1$chains$kgibbs,1,function(x) length(unique(x)))[fit_gjamPY1$modelList$burnin:fit_gjamPY1$modelList$ng]))
Fin_all[8,1]<- "K VI2"
Fin_all[8,2:5]<- VI_fin_table_K2[,1:3]
Fin_all[9,1]<- "K VI"
Fin_all[9,2:5]<- VI_fin_table_K[,1:3]
Fin_all[,2:5]<- round(Fin_all[,2:5], 3)
Fin_all
save(Fin_all, file = paste0(folderpath,"Fin_tab_r5.Rdata"))
#save(Fin_all, file = paste0(folderpath,"Fin_tab_r5.Rdata"))
library("xlsx")
#save(Fin_all, file = paste0(folderpath,"Fin_tab_r5.Rdata"))
#library("xlsx")
# Write the first data set in a new workbook
write.xlsx(Fin_all, file = "Final_table.xlsx")
